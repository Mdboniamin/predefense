{% extends "base.html" %}
{% block content %}
    <h1>Manage Food Items</h1>
    
    {% if food_items %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Restaurant</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for food_item in food_items %}
                        <tr>
                            <td>{{ food_item.id }}</td>
                            <td>{{ food_item.name }}</td>
                            <td>{{ food_item.description or "No description" }}</td>
                            <td>${{ food_item.price }}</td>
                            <td>{{ food_item.restaurant_owner.name }}</td>
                            <td>
                                <a href="{{ url_for('admin.edit_food_item', food_item_id=food_item.id) }}" class="btn btn-sm btn-outline-secondary">Edit</a>
                                <form method="POST" action="{{ url_for('admin.delete_food_item', food_item_id=food_item.id) }}" style="display: inline;">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this food item?')">Delete</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert alert-info">
            <h4>No food items found!</h4>
        </div>
    {% endif %}
    
    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            {% if category == 'warning' %}
                <div style="position: fixed; top: 10px; right: 10px; z-index: 1000;">
                    <form method="POST" action="{{ url_for('admin.undo_delete_food_item') }}" style="display: inline;" id="undoAlert">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm btn-success">Undo</button>
                    </form>
                </div>
                <script>
                    setTimeout(function() {
                        var undoAlert = document.getElementById('undoAlert');
                        if (undoAlert) {
                            undoAlert.style.display = 'none';
                            fetch('/admin/confirm_delete_food_item', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRF-Token': '{{ csrf_token() }}'
                                },
                                body: JSON.stringify({ food_item_id: {{ session.get('pending_delete', {}).get('food_item_id', 0) }} })
                            }).then(response => {
                                if (response.ok) {
                                    window.location.reload();
                                }
                            });
                        }
                    }, 5000);
                </script>
            {% else %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
{% endwith %}
{% endblock content %}